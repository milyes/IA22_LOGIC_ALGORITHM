<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>NetSecurePro Network Guard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
body { font-family: Arial, sans-serif; background: #121212; color: #fff; }
h1 { text-align: center; color: #00ff88; }
#map { height: 300px; margin: 10px; border-radius: 8px; }
table { width: 95%; margin: auto; border-collapse: collapse; }
th, td { border: 1px solid #555; padding: 6px; }
th { background: #00ff88; color: #000; }
tr:nth-child(even) { background: #1e1e1e; }
#refresh { background: #00ff88; color: #000; padding: 8px 15px; border: none; cursor: pointer; display: block; margin: auto; }
</style>
</head>
<body>
<h1>NetSecurePro Network Guard</h1>
<div id="map"></div>
<button id="refresh">ðŸ”„ Actualiser</button>
<table>
<thead><tr><th>IP</th><th>MAC</th><th>Fabricant</th></tr></thead>
<tbody id="deviceTable"><tr><td colspan="3">Chargement...</td></tr></tbody>
</table>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
let map = L.map('map').setView([0, 0], 2);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

async function loadDevices() {
    let res = await fetch('/devices.json?_=' + Date.now());
    let data = await res.json();

    document.getElementById('deviceTable').innerHTML = '';
    map.eachLayer((layer) => { if (layer instanceof L.Marker) map.removeLayer(layer); });

    data.forEach(d => {
        document.getElementById('deviceTable').innerHTML += `<tr><td>${d.ip}</td><td>${d.mac}</td><td>${d.vendor}</td></tr>`;
        if(d.lat && d.lon){
            L.marker([d.lat, d.lon]).addTo(map).bindPopup(`<b>${d.ip}</b><br>${d.mac}<br>${d.vendor}`);
        }
    });

    if(data.length && data[0].lat){
        map.setView([data[0].lat, data[0].lon], 13);
    }
}

document.getElementById('refresh').addEventListener('click', loadDevices);
loadDevices();
setInterval(loadDevices, 15000);
</script>
</body>
</html>
